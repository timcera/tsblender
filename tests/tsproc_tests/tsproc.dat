### TSPROC input file for Tonawanda Creek watershed
## CALIBRATION OF: Streamflow at Attica gage
## COMPONENTS OF OBJECTIVE FUNCTION: daily flow, monthly volume,
## flow-duration (instead of flow-exceedance times), peak flows
#########################################################################

START SETTINGS
  DATE_FORMAT mm/dd/yyyy
#  CONTEXT pest_prep
  CONTEXT model_run
END SETTINGS

START GET_SERIES_WDM
  CONTEXT all
  FILE tonmod.wdm
  DSN 704
  NEW_SERIES_NAME anflow
  DEF_TIME 24:00:00
  FILTER -999
END GET_SERIES_WDM
START REDUCE_TIME_SPAN
  CONTEXT all
  SERIES_NAME anflow
  NEW_SERIES_NAME nflow
  DATE_1 10/01/1990
  TIME_1 24:00:00
  DATE_2 09/30/2011
  TIME_2 24:00:00
END REDUCE_TIME_SPAN

START GET_SERIES_WDM
  CONTEXT all
  FILE tonmod.wdm
  DSN 701
  NEW_SERIES_NAME aoflow
  DEF_TIME 24:00:00
  FILTER -999
END GET_SERIES_WDM
START REDUCE_TIME_SPAN
  CONTEXT all
  SERIES_NAME aoflow
  NEW_SERIES_NAME oflow
  DATE_1 10/01/1990
  TIME_1 24:00:00
  DATE_2 09/30/2011
  TIME_2 24:00:00
END REDUCE_TIME_SPAN

START NEW_TIME_BASE
  CONTEXT all
  SERIES_NAME nflow
  NEW_SERIES_NAME mflow
  TB_SERIES_NAME oflow
END NEW_TIME_BASE

START SERIES_COMPARE
  CONTEXT all
  SERIES_NAME_OBS oflow
  SERIES_NAME_SIM mflow
  NEW_C_TABLE_NAME stats
  BIAS yes
  STANDARD_ERROR yes
  NASH_SUTCLIFFE yes
END SERIES_COMPARE

START VOLUME_CALCULATION
  CONTEXT all
  SERIES_NAME mflow
  NEW_V_TABLE_NAME mvol
  DATE_FILE dates.dat
  FLOW_TIME_UNITS seconds
  FACTOR 1
END VOLUME_CALCULATION
START VOLUME_CALCULATION
  CONTEXT all
  SERIES_NAME oflow
  NEW_V_TABLE_NAME ovol
  DATE_FILE dates.dat
  FLOW_TIME_UNITS seconds
  FACTOR 1
END VOLUME_CALCULATION

#START EXCEEDENCE_TIME
#  CONTEXT all
#  SERIES_NAME mflow
#  NEW_E_TABLE_NAME mtime
#  EXCEEDENCE_TIME_UNITS days
#  UNDER_OVER over
#  FLOW 1
#  FLOW 3
#  FLOW 4.3
#  FLOW 6.2
#  FLOW 9
#  FLOW 13
#  FLOW 19
#  FLOW 27
#  FLOW 39
#  FLOW 56
#  FLOW 81
#  FLOW 120
#  FLOW 170
#  FLOW 240
#  FLOW 350
#  FLOW 500
#  FLOW 720
#  FLOW 1000
#  FLOW 1500
#  FLOW 2200
#END EXCEEDENCE_TIME
#START EXCEEDENCE_TIME
#  CONTEXT all
#  SERIES_NAME oflow
#  NEW_E_TABLE_NAME otime
#  EXCEEDENCE_TIME_UNITS days
#  UNDER_OVER over
#  FLOW 1
#  FLOW 3
#  FLOW 4.3
#  FLOW 6.2
#  FLOW 9
#  FLOW 13
#  FLOW 19
#  FLOW 27
#  FLOW 39
#  FLOW 56
#  FLOW 81
#  FLOW 120
#  FLOW 170
#  FLOW 240
#  FLOW 350
#  FLOW 500
#  FLOW 720
#  FLOW 1000
#  FLOW 1500
#  FLOW 2200
#END EXCEEDENCE_TIME

START FLOW_DURATION
  CONTEXT all
  SERIES_NAME mflow
  NEW_G_TABLE_NAME mduration
END FLOW_DURATION
START FLOW_DURATION
  CONTEXT all
  SERIES_NAME oflow
  NEW_G_TABLE_NAME oduration
END FLOW_DURATION

START HYDRO_EVENTS
  CONTEXT all
  SERIES_NAME mflow
  NEW_SERIES_NAME mpeaks
  WINDOW 5
# Attica peak-above-base = 1900; use 1000 for daily peaks
  MIN_PEAK 1000
  RISE_LAG 1
  FALL_LAG 1
END HYDRO_EVENTS
START HYDRO_EVENTS
  CONTEXT all
  SERIES_NAME oflow
  NEW_SERIES_NAME opeaks
  WINDOW 5
  MIN_PEAK 1000
  RISE_LAG 1
  FALL_LAG 1
END HYDRO_EVENTS

START LIST_OUTPUT
  CONTEXT all
  FILE model.out
  SERIES_NAME mflow
  SERIES_NAME mpeaks

  SERIES_FORMAT long
  V_TABLE_NAME mvol
#  E_TABLE_NAME mtime
  G_TABLE_NAME mduration
END LIST_OUTPUT

START WRITE_PEST_FILES
# General information
  CONTEXT all
  TEMPLATE_FILE p2p_base.tpl
  MODEL_INPUT_FILE p2p_base.dat
  PARAMETER_DATA_FILE parm.dat
  PARAMETER_GROUP_FILE group.dat
  NEW_PEST_CONTROL_FILE atticaq2.pst
  NEW_INSTRUCTION_FILE model.ins
  MODEL_COMMAND_LINE model.bat
  OBSERVATION_SERIES_NAME oflow
  MODEL_SERIES_NAME mflow
  SERIES_WEIGHTS_EQUATION 0.85/(@_abs_value+0.001)
  SERIES_WEIGHTS_MIN_MAX 0.0000001  1000
  OBSERVATION_SERIES_NAME opeaks
  MODEL_SERIES_NAME mpeaks
  SERIES_WEIGHTS_EQUATION 1.0e-4/sqrt(@_abs_value)
  OBSERVATION_V_TABLE_NAME ovol
  MODEL_V_TABLE_NAME mvol
  V_TABLE_WEIGHTS_EQUATION 8.0e-4/sqrt(@_abs_value)
#  OBSERVATION_E_TABLE_NAME otime
#  MODEL_E_TABLE_NAME mtime
#  E_TABLE_WEIGHTS_EQUATION 560.0
  OBSERVATION_G_TABLE_NAME oduration
  MODEL_G_TABLE_NAME mduration
  G_TABLE_WEIGHTS_EQUATION 560.0
END WRITE_PEST_FILES
